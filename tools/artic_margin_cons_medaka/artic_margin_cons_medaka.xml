<tool id="artic_margin_cons_medaka" name="ARTIC margin_cons_medaka" version="0.1.0-1005a47+galaxy0">
    <description>Generate consensus fasta file from a reference fasta, bam alignment and VCF file</description>
    <requirements>
        <requirement type="package" version="0.6.8">pyvcf</requirement>
        <requirement type="package" version="1.76">biopython</requirement>
        <requirement type="package" version="1.9">samtools</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        ln -s '${input_alignment}' '${input_alignment.element_identifier}.bam' &&
        samtools index '${input_alignment.element_identifier}.bam' &&
        ln -s '${input_variants}' '${input_variants.element_identifier}.vcf' &&
        python '${__tool_directory__}/margin_cons_medaka.py'
          --depth '${minimum_depth}'
          --quality '${minimum_quality}'
          '${ref_fasta}'
          '${input_variants.element_identifier}.vcf'
          '${input_alignment.element_identifier}.bam'
          > '${consensus_fasta}'
          2> '${report}'
    ]]></command>
    <inputs>
        <param name="ref_fasta" type="data" format="fasta" label="Reference Sequence"/>
        <param name="input_alignment" type="data" format="bam" label="Input Alignment"/>
        <param name="input_variants" type="data" format="vcf" label="Input Variants"/>
        <param name="minimum_depth" type="integer" value="5" min="1" max="500" label="Minimum depth to call a variant"/>
        <param name="minimum_quality" type="integer" value="0" min="0" max="100" label="Minimum quality to call a variant"/>
    </inputs>
    <outputs>
        <data name="consensus_fasta" format="fasta" label="${tool.name} on ${on_string}: Consensus (.fasta)" />
        <data name="report" format="tabular" label="${tool.name} on ${on_string}: Report" />
    </outputs>
    <tests>
    </tests>
    <help><![CDATA[
    ]]></help>
    <citations>
    </citations>
</tool>
